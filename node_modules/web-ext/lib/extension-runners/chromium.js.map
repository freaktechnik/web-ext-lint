{"version":3,"file":"chromium.js","names":["fs","path","Launcher","ChromeLauncher","launch","defaultChromiumLaunch","createLogger","TempDir","isDirectory","fileExists","log","import","meta","url","EXCLUDED_CHROME_FLAGS","DEFAULT_CHROME_FLAGS","defaultFlags","filter","flag","includes","_receivedData","WeakMap","_isProcessingMessage","_lastId","_deferredResponses","_disconnected","_disconnectedPromise","_resolveDisconnectedPromise","_ChromeDevtoolsProtocolClient_brand","WeakSet","ChromeDevtoolsProtocolClient","constructor","chromiumInstance","_classPrivateMethodInitSpec","_classPrivateFieldInitSpec","Map","_defineProperty","process","env","TEST_LOG_VERBOSE_CDP","incoming","outgoing","remoteDebuggingPipes","_classPrivateFieldSet","Promise","resolve","closed","warn","_assertClassBrand","_finalizeDisconnect","call","on","data","_classPrivateFieldGet","_processNextMessage","error","outgoingPipe","waitUntilDisconnected","sendCommand","method","params","sessionId","undefined","_this$lastId","Error","message","id","rawMessage","JSON","stringify","stderr","write","reject","set","end","indexOf","slice","result","parse","deferredResponse","get","delete","err","e","values","clear","ChromiumExtensionRunner","cleanupCallbacks","chromiumLaunch","forceUseDeprecatedLoadExtension","exiting","_promiseSetupDone","Set","getName","run","setupInstance","isUserDataDir","dirPath","localStatePath","join","defaultPath","isProfileDir","securePreferencesPath","getProfilePaths","chromiumProfile","userDataDir","profileDirName","isProfileDirAndNotUserData","dir","base","extensions","map","sourceDir","chromiumBinary","debug","chromeFlags","push","args","some","test","keepProfileChanges","tmpDir","create","tmpDirPath","cp","recursive","startingUrl","startUrl","startingUrls","Array","isArray","shift","chromePath","logLevel","verbose","ignoreDefaultFlags","cdp","initialChromiumInstance","once","info","exit","cdpSupportsExtensionsLoadUnpacked","kill","reloadAllExtensions","runnerName","reloadAllExtensionsFallbackForChrome125andEarlier","stdout","Date","toTimeString","targetInfos","targets","type","t","startsWith","targetId","hasExistingTarget","length","newWindow","background","windowState","codeToEvaluateInChrome","developerPrivate","chrome","getExtensionsInfo","extensionIds","extension","location","reloadPromises","extensionId","reload","failQuietly","populateErrorForUnpacked","loadError","all","targetResult","flatten","i","_evalResult$result","evalResult","expression","awaitPromise","evalResultReturnValue","value","r","setTimeout","exceptionDetails","text","reloadExtensionBySourceDir","extensionSourceDir","registerCleanup","fn","add","catch"],"sources":["../../src/extension-runners/chromium.js"],"sourcesContent":["/**\n * This module provide an ExtensionRunner subclass that manage an extension executed\n * in a Chromium-based browser instance.\n */\n\nimport fs from 'fs/promises';\nimport path from 'path';\n\nimport {\n  Launcher as ChromeLauncher,\n  launch as defaultChromiumLaunch,\n} from 'chrome-launcher';\n\nimport { createLogger } from '../util/logger.js';\nimport { TempDir } from '../util/temp-dir.js';\nimport isDirectory from '../util/is-directory.js';\nimport fileExists from '../util/file-exists.js';\n\nconst log = createLogger(import.meta.url);\n\nconst EXCLUDED_CHROME_FLAGS = [\n  '--disable-extensions',\n  '--mute-audio',\n  '--disable-component-update',\n];\n\nexport const DEFAULT_CHROME_FLAGS = ChromeLauncher.defaultFlags().filter(\n  (flag) => !EXCLUDED_CHROME_FLAGS.includes(flag),\n);\n\n// This is a client for the Chrome Devtools protocol. The methods and results\n// are documented at https://chromedevtools.github.io/devtools-protocol/tot/\nclass ChromeDevtoolsProtocolClient {\n  #receivedData = '';\n  #isProcessingMessage = false;\n  #lastId = 0;\n  #deferredResponses = new Map();\n  #disconnected = false;\n  #disconnectedPromise;\n  #resolveDisconnectedPromise;\n\n  // Print all exchanged CDP messages to ease debugging.\n  TEST_LOG_VERBOSE_CDP = process.env.TEST_LOG_VERBOSE_CDP;\n\n  constructor(chromiumInstance) {\n    // remoteDebuggingPipes is from chrome-launcher, see\n    // https://github.com/GoogleChrome/chrome-launcher/pull/347\n    const { incoming, outgoing } = chromiumInstance.remoteDebuggingPipes;\n    this.#disconnectedPromise = new Promise((resolve) => {\n      this.#resolveDisconnectedPromise = resolve;\n    });\n    if (incoming.closed) {\n      // Strange. Did Chrome fail to start, or exit on startup?\n      log.warn('CDP already disconnected at initialization');\n      this.#finalizeDisconnect();\n      return;\n    }\n    incoming.on('data', (data) => {\n      this.#receivedData += data;\n      this.#processNextMessage();\n    });\n    incoming.on('error', (error) => {\n      log.error(error);\n      this.#finalizeDisconnect();\n    });\n    incoming.on('close', () => this.#finalizeDisconnect());\n    this.outgoingPipe = outgoing;\n  }\n\n  waitUntilDisconnected() {\n    return this.#disconnectedPromise;\n  }\n\n  async sendCommand(method, params, sessionId = undefined) {\n    if (this.#disconnected) {\n      throw new Error(`CDP disconnected, cannot send: command ${method}`);\n    }\n    const message = {\n      id: ++this.#lastId,\n      method,\n      params,\n      sessionId,\n    };\n    const rawMessage = `${JSON.stringify(message)}\\x00`;\n    if (this.TEST_LOG_VERBOSE_CDP) {\n      process.stderr.write(`[CDP] [SEND] ${rawMessage}\\n`);\n    }\n    return new Promise((resolve, reject) => {\n      // CDP will always send a response.\n      this.#deferredResponses.set(message.id, { method, resolve, reject });\n      this.outgoingPipe.write(rawMessage);\n    });\n  }\n\n  #processNextMessage() {\n    if (this.#isProcessingMessage) {\n      return;\n    }\n    this.#isProcessingMessage = true;\n    let end = this.#receivedData.indexOf('\\x00');\n    while (end !== -1) {\n      const rawMessage = this.#receivedData.slice(0, end);\n      this.#receivedData = this.#receivedData.slice(end + 1); // +1 skips \\x00.\n      try {\n        if (this.TEST_LOG_VERBOSE_CDP) {\n          process.stderr.write(`[CDP] [RECV] ${rawMessage}\\n`);\n        }\n        const { id, error, result } = JSON.parse(rawMessage);\n        const deferredResponse = this.#deferredResponses.get(id);\n        if (deferredResponse) {\n          this.#deferredResponses.delete(id);\n          if (error) {\n            const err = new Error(error.message || 'Unexpected CDP response');\n            deferredResponse.reject(err);\n          } else {\n            deferredResponse.resolve(result);\n          }\n        } else {\n          // Dropping events and non-response messages since we don't need it.\n        }\n      } catch (e) {\n        log.error(e);\n      }\n      end = this.#receivedData.indexOf('\\x00');\n    }\n    this.#isProcessingMessage = false;\n    if (this.#disconnected) {\n      for (const { method, reject } of this.#deferredResponses.values()) {\n        reject(new Error(`CDP connection closed before response to ${method}`));\n      }\n      this.#deferredResponses.clear();\n      this.#resolveDisconnectedPromise();\n    }\n  }\n\n  #finalizeDisconnect() {\n    if (!this.#disconnected) {\n      this.#disconnected = true;\n      this.#processNextMessage();\n    }\n  }\n}\n\n/**\n * Implements an IExtensionRunner which manages a Chromium instance.\n */\nexport class ChromiumExtensionRunner {\n  cleanupCallbacks;\n  params;\n  chromiumInstance;\n  chromiumLaunch;\n  // --load-extension is deprecated, but only supported in Chrome 126+, see:\n  // https://github.com/mozilla/web-ext/issues/3388#issuecomment-2906982117\n  forceUseDeprecatedLoadExtension;\n  exiting;\n  _promiseSetupDone;\n\n  constructor(params) {\n    const { chromiumLaunch = defaultChromiumLaunch } = params;\n    this.params = params;\n    this.chromiumLaunch = chromiumLaunch;\n    // We will try to use Extensions.loadUnpacked first (Chrome 126+), and if\n    // that does not work fall back to --load-extension.\n    this.forceUseDeprecatedLoadExtension = false;\n    this.cleanupCallbacks = new Set();\n  }\n\n  // Method exported from the IExtensionRunner interface.\n\n  /**\n   * Returns the runner name.\n   */\n  getName() {\n    return 'Chromium';\n  }\n\n  async run() {\n    // Run should never be called more than once.\n    this._promiseSetupDone = this.setupInstance();\n    await this._promiseSetupDone;\n  }\n\n  static async isUserDataDir(dirPath) {\n    const localStatePath = path.join(dirPath, 'Local State');\n    const defaultPath = path.join(dirPath, 'Default');\n    // Local State and Default are typical for the user-data-dir\n    return (\n      (await fileExists(localStatePath)) && (await isDirectory(defaultPath))\n    );\n  }\n\n  static async isProfileDir(dirPath) {\n    const securePreferencesPath = path.join(dirPath, 'Secure Preferences');\n    //Secure Preferences is typical for a profile dir inside a user data dir\n    return await fileExists(securePreferencesPath);\n  }\n\n  static async getProfilePaths(chromiumProfile) {\n    if (!chromiumProfile) {\n      return {\n        userDataDir: null,\n        profileDirName: null,\n      };\n    }\n\n    const isProfileDirAndNotUserData =\n      (await ChromiumExtensionRunner.isProfileDir(chromiumProfile)) &&\n      !(await ChromiumExtensionRunner.isUserDataDir(chromiumProfile));\n\n    if (isProfileDirAndNotUserData) {\n      const { dir: userDataDir, base: profileDirName } =\n        path.parse(chromiumProfile);\n      return {\n        userDataDir,\n        profileDirName,\n      };\n    }\n\n    return {\n      userDataDir: chromiumProfile,\n      profileDirName: null,\n    };\n  }\n\n  /**\n   * Setup the Chromium Profile and run a Chromium instance.\n   */\n  async setupInstance() {\n    // NOTE: This function may be called twice, if the user is using an old\n    // Chrome version (before Chrome 126), because then we have to add a\n    // command-line flag (--load-extension) to load the extension. For details,\n    // see:\n    // https://github.com/mozilla/web-ext/issues/3388#issuecomment-2906982117\n\n    // Start chrome pointing it to a given profile dir\n    const extensions = this.params.extensions.map(({ sourceDir }) => sourceDir);\n\n    const { chromiumBinary } = this.params;\n\n    log.debug('Starting Chromium instance...');\n\n    if (chromiumBinary) {\n      log.debug(`(chromiumBinary: ${chromiumBinary})`);\n    }\n\n    const chromeFlags = [...DEFAULT_CHROME_FLAGS];\n    chromeFlags.push('--remote-debugging-pipe');\n\n    if (!this.forceUseDeprecatedLoadExtension) {\n      chromeFlags.push('--enable-unsafe-extension-debugging');\n    } else {\n      chromeFlags.push(`--load-extension=${extensions.join(',')}`);\n    }\n\n    if (this.params.args) {\n      chromeFlags.push(...this.params.args);\n    }\n\n    // `--remote-debugging-pipe` results in `navigator.webdriver == true` in\n    // the launched Chromium instance (unless a Chromium session exists\n    // already, in which case the existing session is used, which typically\n    // has `navigator.webdriver == false`). This breaks websites with bot\n    // detection features. The following flag prevents this.\n    // Only pass this flag if `--enable-blink-features=AutomationControlled`\n    // is not passed.\n    if (\n      !chromeFlags.some((flag) =>\n        /^--enable-blink-features=(.*,)?AutomationControlled(,|$)/.test(flag),\n      )\n    ) {\n      chromeFlags.push('--disable-blink-features=AutomationControlled');\n    }\n\n    // eslint-disable-next-line prefer-const\n    let { userDataDir, profileDirName } =\n      await ChromiumExtensionRunner.getProfilePaths(\n        this.params.chromiumProfile,\n      );\n\n    if (userDataDir && this.params.keepProfileChanges) {\n      if (\n        profileDirName &&\n        !(await ChromiumExtensionRunner.isUserDataDir(userDataDir))\n      ) {\n        throw new Error(\n          'The profile you provided is not in a ' +\n            'user-data-dir. The changes cannot be kept. Please either ' +\n            'remove --keep-profile-changes or use a profile in a ' +\n            'user-data-dir directory',\n        );\n      }\n    } else if (!this.params.keepProfileChanges) {\n      // the user provided an existing profile directory but doesn't want\n      // the changes to be kept. we copy this directory to a temporary\n      // user data dir.\n      const tmpDir = new TempDir();\n      await tmpDir.create();\n      const tmpDirPath = tmpDir.path();\n\n      if (userDataDir && profileDirName) {\n        // copy profile dir to this temp user data dir.\n        await fs.cp(\n          path.join(userDataDir, profileDirName),\n          path.join(tmpDirPath, profileDirName),\n          { recursive: true },\n        );\n      } else if (userDataDir) {\n        await fs.cp(userDataDir, tmpDirPath, { recursive: true });\n      }\n      userDataDir = tmpDirPath;\n    }\n\n    if (profileDirName) {\n      chromeFlags.push(`--profile-directory=${profileDirName}`);\n    }\n\n    let startingUrl;\n    if (this.params.startUrl) {\n      const startingUrls = Array.isArray(this.params.startUrl)\n        ? this.params.startUrl\n        : [this.params.startUrl];\n      startingUrl = startingUrls.shift();\n      chromeFlags.push(...startingUrls);\n    }\n\n    this.chromiumInstance = await this.chromiumLaunch({\n      chromePath: chromiumBinary,\n      chromeFlags,\n      startingUrl,\n      userDataDir,\n      logLevel: this.params.verbose ? 'verbose' : 'silent',\n      // Ignore default flags to keep the extension enabled.\n      ignoreDefaultFlags: true,\n    });\n    this.cdp = new ChromeDevtoolsProtocolClient(this.chromiumInstance);\n\n    const initialChromiumInstance = this.chromiumInstance;\n    this.chromiumInstance.process.once('close', () => {\n      if (this.chromiumInstance !== initialChromiumInstance) {\n        // This happens when we restart Chrome to fall back to --load-extension.\n        return;\n      }\n      this.chromiumInstance = null;\n\n      if (!this.exiting) {\n        log.info('Exiting on Chromium instance disconnected.');\n        this.exit();\n      }\n    });\n\n    if (!this.forceUseDeprecatedLoadExtension) {\n      // Assume that the required Extensions.loadUnpacked CDP method is\n      // supported. If it is not, we will fall back to --load-extension.\n      let cdpSupportsExtensionsLoadUnpacked = true;\n      for (const sourceDir of extensions) {\n        try {\n          await this.cdp.sendCommand('Extensions.loadUnpacked', {\n            path: sourceDir,\n          });\n        } catch (e) {\n          // Chrome 125- will emit the following message:\n          if (e.message === \"'Extensions.loadUnpacked' wasn't found\") {\n            cdpSupportsExtensionsLoadUnpacked = false;\n            break;\n          }\n          log.error(`Failed to load extension at ${sourceDir}: ${e.message}`);\n          // We do not have to throw - the extension can work again when\n          // auto-reload is used. But users may like a hard fail, and this is\n          // consistent with the firefox runner.\n          throw e;\n        }\n      }\n      if (!cdpSupportsExtensionsLoadUnpacked) {\n        // Retry once, now with --load-extension.\n        log.warn('Cannot load extension via CDP, falling back to old method');\n        this.forceUseDeprecatedLoadExtension = true;\n        this.chromiumInstance = null;\n        await initialChromiumInstance.kill();\n        await this.cdp.waitUntilDisconnected();\n        this.cdp = null;\n        return this.setupInstance();\n      }\n    }\n  }\n\n  /**\n   * Reloads all the extensions, collect any reload error and resolves to\n   * an array composed by a single ExtensionRunnerReloadResult object.\n   */\n  async reloadAllExtensions() {\n    const runnerName = this.getName();\n\n    if (this.forceUseDeprecatedLoadExtension) {\n      this.reloadAllExtensionsFallbackForChrome125andEarlier();\n    } else {\n      for (const { sourceDir } of this.params.extensions) {\n        try {\n          await this.cdp.sendCommand('Extensions.loadUnpacked', {\n            path: sourceDir,\n          });\n        } catch (e) {\n          log.error(`Failed to load extension at ${sourceDir}: ${e.message}`);\n        }\n      }\n    }\n\n    process.stdout.write(\n      `\\rLast extension reload: ${new Date().toTimeString()}`,\n    );\n    log.debug('\\n');\n\n    return [{ runnerName }];\n  }\n\n  async reloadAllExtensionsFallbackForChrome125andEarlier() {\n    // Ideally, we'd like to use the \"Extensions.loadUnpacked\" CDP command to\n    // reload an extension, but that is unsupported in Chrome 125 and earlier.\n    //\n    // As a fallback, connect to chrome://extensions/ and reload from there.\n    // Since we are targeting old Chrome versions, we can safely use the\n    // chrome.developerPrivate APIs, because these are never going to change\n    // for the old browser versions. Do NOT use this for newer versions!\n    //\n    // Target.* CDP methods documented at: https://chromedevtools.github.io/devtools-protocol/tot/Target/\n    // developerPrivate documented at:\n    // https://source.chromium.org/chromium/chromium/src/+/main:chrome/common/extensions/api/developer_private.idl\n    //\n    // Specific revision that exposed developerPrivate to chrome://extensions/:\n    // https://source.chromium.org/chromium/chromium/src/+/main:chrome/common/extensions/api/developer_private.idl;drc=69bf75316e7ae533c0a0dccc1a56ca019aa95a1e\n    // https://chromium.googlesource.com/chromium/src.git/+/69bf75316e7ae533c0a0dccc1a56ca019aa95a1e\n    //\n    // Specific revision that introduced developerPrivate.getExtensionsInfo:\n    // https://source.chromium.org/chromium/chromium/src/+/main:chrome/common/extensions/api/developer_private.idl;drc=69bf75316e7ae533c0a0dccc1a56ca019aa95a1e\n    //\n    // The above changes are from 2015; The --remote-debugging-pipe feature\n    // that we rely on for CDP was added in 2018; this is the version of the\n    // developerPrivate API at that time:\n    // https://source.chromium.org/chromium/chromium/src/+/main:chrome/common/extensions/api/developer_private.idl;drc=c9ae59c8f37d487f1f01c222deb6b7d1f51c99c2\n\n    // Find an existing chrome://extensions/ tab, if it exists.\n    let { targetInfos: targets } = await this.cdp.sendCommand(\n      'Target.getTargets',\n      { filter: [{ type: 'tab' }] },\n    );\n    targets = targets.filter((t) => t.url.startsWith('chrome://extensions/'));\n    let targetId;\n    const hasExistingTarget = targets.length > 0;\n    if (hasExistingTarget) {\n      targetId = targets[0].targetId;\n    } else {\n      const result = await this.cdp.sendCommand('Target.createTarget', {\n        url: 'chrome://extensions/',\n        newWindow: true,\n        background: true,\n        windowState: 'minimized',\n      });\n      targetId = result.targetId;\n    }\n    const codeToEvaluateInChrome = async () => {\n      // This function is serialized and executed in Chrome. Designed for\n      // compatibility with Chrome 69 - 125. Do not use JS syntax of functions\n      // that are not supported in these versions!\n\n      // eslint-disable-next-line no-undef\n      const developerPrivate = chrome.developerPrivate;\n      if (!developerPrivate || !developerPrivate.getExtensionsInfo) {\n        // When chrome://extensions/ is still loading, its document URL may be\n        // about:blank and the chrome.developerPrivate API is not exposed.\n        return 'NOT_READY_PLEASE_RETRY';\n      }\n      const extensionIds = [];\n      await new Promise((resolve) => {\n        developerPrivate.getExtensionsInfo((extensions) => {\n          for (const extension of extensions || []) {\n            if (extension.location === 'UNPACKED') {\n              // We only care about those loaded via --load-extension.\n              extensionIds.push(extension.id);\n            }\n          }\n          resolve();\n        });\n      });\n      const reloadPromises = extensionIds.map((extensionId) => {\n        return new Promise((resolve, reject) => {\n          developerPrivate.reload(\n            extensionId,\n            // Suppress alert dialog when load fails.\n            { failQuietly: true, populateErrorForUnpacked: true },\n            (loadError) => {\n              if (loadError) {\n                reject(new Error(loadError.error));\n              } else {\n                resolve();\n              }\n            },\n          );\n        });\n      });\n      await Promise.all(reloadPromises);\n      return reloadPromises.length;\n    };\n    try {\n      const targetResult = await this.cdp.sendCommand('Target.attachToTarget', {\n        targetId,\n        flatten: true,\n      });\n      if (!targetResult.sessionId) {\n        throw new Error('Unexpectedly, no sessionId from attachToTarget');\n      }\n      // In practice, we're going to run the logic only once. But if we are\n      // unlucky, chrome://extensions is still loading, so we will then retry.\n      for (let i = 0; i < 3; ++i) {\n        const evalResult = await this.cdp.sendCommand(\n          'Runtime.evaluate',\n          {\n            expression: `(${codeToEvaluateInChrome})();`,\n            awaitPromise: true,\n          },\n          targetResult.sessionId,\n        );\n        const evalResultReturnValue = evalResult.result?.value;\n        if (evalResultReturnValue === 'NOT_READY_PLEASE_RETRY') {\n          await new Promise((r) => setTimeout(r, 200 * i));\n          continue;\n        }\n        if (evalResult.exceptionDetails) {\n          log.error(`Failed to reload: ${evalResult.exceptionDetails.text}`);\n        }\n        if (evalResultReturnValue !== this.params.extensions.length) {\n          log.warn(`Failed to reload extensions: ${evalResultReturnValue}`);\n        }\n        break;\n      }\n    } finally {\n      if (!hasExistingTarget && targetId) {\n        try {\n          await this.cdp.sendCommand('Target.closeTarget', { targetId });\n        } catch (e) {\n          log.error(e);\n        }\n      }\n    }\n  }\n\n  /**\n   * Reloads a single extension, collect any reload error and resolves to\n   * an array composed by a single ExtensionRunnerReloadResult object.\n   */\n  async reloadExtensionBySourceDir(\n    extensionSourceDir, // eslint-disable-line no-unused-vars\n  ) {\n    // TODO(rpl): detect the extension ids assigned to the\n    // target extensions and map it to the extensions source dir\n    // (https://github.com/mozilla/web-ext/issues/1687).\n    return this.reloadAllExtensions();\n  }\n\n  /**\n   * Register a callback to be called when the runner has been exited\n   * (e.g. the Chromium instance exits or the user has requested web-ext\n   * to exit).\n   */\n  registerCleanup(fn) {\n    this.cleanupCallbacks.add(fn);\n  }\n\n  /**\n   * Exits the runner, by closing the managed Chromium instance.\n   */\n  async exit() {\n    this.exiting = true;\n\n    // Wait for the setup to complete if the extension runner is already\n    // being started.\n    if (this._promiseSetupDone) {\n      // Ignore initialization errors if any.\n      await this._promiseSetupDone.catch((err) => {\n        log.debug(`ignored setup error on chromium runner shutdown: ${err}`);\n      });\n    }\n\n    if (this.chromiumInstance) {\n      await this.chromiumInstance.kill();\n      this.chromiumInstance = null;\n    }\n\n    if (this.cdp) {\n      await this.cdp.waitUntilDisconnected();\n      this.cdp = null;\n    }\n\n    // Call all the registered cleanup callbacks.\n    for (const fn of this.cleanupCallbacks) {\n      try {\n        fn();\n      } catch (error) {\n        log.error(error);\n      }\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]}